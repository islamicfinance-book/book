<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cryptocurrency in Islamic Finance</title>

    <link href="css/gitbook/style.css" rel="stylesheet" />
    <link href="css/gitbook/plugin-table.css" rel="stylesheet" />
    <link href="css/gitbook/plugin-bookdown.css" rel="stylesheet" />

  <!--
    <link href="css/gitbook/plugin-highlight.css" rel="stylesheet" />
    <link href="css/gitbook/plugin-search.css" rel="stylesheet" />
  -->

  </head>
  <body>
    <div class="book without-animation with-summary   font-size-2 font-family-1">
      <div class="book-summary">
        <nav role="navigation">
          <ul class="summary">
            <li class="chapter">
              <a href="index.html">Home</a>
            </li>
            <li class="chapter">
              <a href="basics.html">Basics</a>
              <ul>
                <li>
                  <a href="basics.html#what">What is a cryptocurrency?</a>
                </li>
                <li>
                  <a href="basics.html#different">Differences from traditional currency</a>
                </li>
                <li>
                  <a href="basics.html#sharia">Sharia rulings on cryptocurrency</a>
                </li>
                <li>
                  <a href="basics.html#value">How cryptocurrencies obtain value</a>
                </li>
                <li>
                  <a href="basics.html#protection">Security through cryptography</a>
                </li>
              </ul>
            </li>
            <li class="chapter">
              <a href="definitions.html">Definitions</a>
              <ul>
                <li class="chapter">
                  <a href="definitions.html#blockchain">Blockchain</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#bitcoin">Bitcoin and Satoshi Nakamoto</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#ethereum">Ethereum</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#other_coins">Other Coins</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#forks">What are forks?</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#fees">Transaction fees</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#wallets">Addresses and Wallets</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#exchanges">Exchanges</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#contracts">Smart Contracts</a>
                </li>
                <li class="chapter">
                  <a href="definitions.html#social_media">Social Media Essentials</a>
                </li>
              </ul>
            </li>
            <li class="chapter">
              <a href="new_stuff.html">Trending Tech</a>
              <ul>
                <li>
                  <a href="new_stuff.html#stablecoins">Stablecoins</a>
                </li>
                <li>
                  <a href="new_stuff.html#lightning">Lightning Network</a>
                </li>
                <li>
                  <a href="new_stuff.html#zksnarks">zkSnarks</a>
                </li>
                <li>
                  <a href="new_stuff.html#bridges">Bridges</a>
                </li>
              </ul>
            </li>
            <li class="chapter">
              <a href="ifinance.html">Islamic Finance</a>
              <ul>
                <li><a href="ifinance.html#intro">An Introduction</a></li>
                <li><a href="ifinance.html#risk">Sharia Risk</a></li>
                <li><a href="ifinance.html#regulation">Regulation</a></li>
                <li><a href="ifinance.html#microfinance">Islamic Microfinance</a></li>
              </ul>
            </li>
            <li class="chapter">
              <a href="coding.html">Coding Smart Contracts</a>
            </li>
            <li class="chapter">
              <a href="switch_to_blockchain.html">Switching to Blockchain</a>
              <ul>
                <li><a href="switch_to_blockchain.html#border">International payments</a></li>
                <li><a href="switch_to_blockchain.html#transparency">Transparent banks and currency</a></li>
                <li><a href="switch_to_blockchain.html#supply">Supply Chain</a></li>
                <li><a href="switch_to_blockchain.html#assets">Asset Ownership</a></li>
                <li><a href="switch_to_blockchain.html#identity">Identity</a></li>
                <li><a href="switch_to_blockchain.html#storage">Storage</a></li>
                <li><a href="switch_to_blockchain.html#tokens">Tokens</a></li>
                <li><a href="switch_to_blockchain.html#governance">Corporate Governance</a></li>
                <li><a href="switch_to_blockchain.html#collectibles">Collectibles</a></li>
                <li><a href="switch_to_blockchain.html#stablecoins">Stablecoins</a></li>
              </ul>
            </li>
            <li class="chapter">
              <a href="skepticism.html">Skepticism</a>
              <ul>
                <li><a href="skepticism.html#practicality">Practicality</a></li>
                <li><a href="skepticism.html#reverse">Irreversible</a></li>
                <li><a href="skepticism.html#security">Security and Theft</a></li>
                <li><a href="skepticism.html#attacks">51% Attacks</a></li>
                <li><a href="skepticism.html#energy">Energy Costs</a></li>
                <li><a href="skepticism.html#contracts">Untrusted Contracts</a></li>
                <li><a href="skepticism.html#stablecoins">Stablecoins</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
      <div class="book-body fixed">
        <div class="body-inner">
          <div class="book-header fixed">
            early outline... more writing in progress...
          </div>
          <div class="page-wrapper" role="main">
            <div class="page-inner">
              <section class="normal" id="section-">
                <h2>Coding Smart Contracts</h2>
                <p>
                  The most common programming language for Ethereum contracts is Solidity, a JavaScript-inspired (but still distinct) programming language.
                  There is an ecosystem of tools for IDEs (such as <a href="https://remix.ethereum.org/">Remix</a>),
                  testing (such as <a href="https://www.trufflesuite.com/">Truffle</a>),
                  and static analysis for security.
                </p>
                <p>
                  Much research into smart contracts is invested into improving Solidity, particularly on securing key functions and avoiding unanticipated consequences.

                  Flint lang (getting updates again: https://github.com/flintlang/flint) Another language is Vyper, a Pythonic https://github.com/ethereum/vyper https://github.com/CityOfZion/neo-python Microsoft Azure, Amazon Web Services (AWS), and Google Cloud all have cloud services which can help developers with Ethereum blockchain apps. https://webln.dev/#/ smart contract honeypots https://github.com/thec00n/smart-contract-honeypots https://medium.com/0x-project/announcing-0x-js-30dff30b10f https://o1labs.org/blog/posts/snarky.html Ethereum from scratch: Part 1: Ping https://news.ycombinator.com/item?id=14816008
                </p>

                <h4>Mudaraba Contracts</h4>
                <p>
                  A common profit-sharing contract in Islamic finance is mudaraba. An investor and an entrepreneur invest their resources — suppose that the investor puts up 70% of the startup capital. Profits from the business are divided 70/30 until the investor is repaid, after which they often offer a more favorable rate (suppose 50/50) to incentivize the entrepreneur to pay back the loan.

                  A smart contract would define the expected inputs and outputs in computer code.

                  Profit-sharing requires businesses to maintain accounting books (possibly for the first time). If a mudaraba account can send and receive payments, its record on the blockchain would serve as a transparent ledger, and it would never have a negative balance.

                  Smart contracts could potentially make Islamic finance successful, but millions of dollars have been lost to code exploits or wallets terminated by unauthorized users. Privately I had been sketching out designs for a language or IDE which would divide your code into classes of
                  users, but I didn’t have the necessary background knowledge on compilers.

                  <strong>Enter Flint</strong>
                  In May 2018 the Ethereum Foundation gave grants to several promising projects, including $10k to Flint language for smart contracts. Flint restricts users and mutating functions on a language level, and its compiler is written in Swift. You can read more about it here:
                  Flint: A New Language for Safe Smart Contracts on Ethereum
                  To explore the language, I decided to represent a mudaraba (a common contract from Islamic finance and microfinance) in Flint.

                  <strong>Basics of Mudaraba</strong>
                  A mudaraba is a type of musharaka (profit-sharing contract) which provides capital to a business. The lender and business owner both invest in the success of the business:
                  ~ If the investment loses money, the loss is split proportionally to the initial investment. It’s easy to remember by thinking what would happen in a 100% loss.
                  ~ If the investment is profitable, those profits are split according to an agreed ratio. Lenders will incentivize the business owner, and compete with each other, by offering a greater share of profits. For example, a 80–20 partnership may agree to split profits 70–30. In any case, the success of the investment depends on reliable accounting, which typically involves more overhead and complexity (potentially another crypto solution?).
                  ~ Unlike other types of musharaka, a mudaraba lender is typically a “silent partner” and not deeply involved in business decisions.
                  ~ There are additional rules about adjusting the profit ratio and mutual decisions to end the contract, but I don’t want to code everything at once. For this example, we have a fixed profit ratio and either side can end the contract at any time.

                  <strong>Initial Structure</strong>
                  There are contract instance variables, and blocks which
                  contain multiple functions.

                  <strong>What any user can do</strong>
                    Initializing a contract happens in the (any) block, because no bank or business address has been set yet. An @ payable function is called when money is paid in, in case you have the smart contract reacting to that.
                    I debated about when the bank/business profit share should be set. In the initial step, neither side has invested funds, but they also want to make sure it’s a trustable contract.
                    ~ if the owner does not invest satisfactory funds or takes time to invest for some reason, the bank can delay calling start() of the contract, or cancel()
                    ~ if the bank does not set the promised profit ratio, or invest satisfactory funds, the owner can cancel() or not move funds into the contract

                  <strong>What business owners can do </strong>
                  I want to allow multiple payments into the investment
                  wallet, but the owner shouldn’t be allowed to change the initial investment after the contract has started. Cryptocurrencies don’t have an option to reject or return-to-sender payments, so in a more resilient contract, maybe this balance could be stored in a variable, or there could be a reclaim function.

                  <strong>What banks can do </strong>
                  I’ve created a separate function name investFromBank to avoid conflict with the investFromBusiness function. I’ve also prevented the bank from changing its initial investment.

                  <strong>The contract closing function </strong>
                  This is the calculation which matters most; canceling or closing the contract with distributed profits. Here I am relying on code in the “future” directory of Flint, so don’t depend on it.
                  In event of the contract closing before it started, I direct to return initial investments.
                  Whenever the contract is closed there would be gas and
                  transaction fees, but I believe that the bank is in the right to charge the client for these fees; in Islamic finance this is permissible even in Qard al-Hassan benevolent loans.

                  <strong>Compiling the contract </strong>
                  Does any of this work yet? The Flint language repo comes with a Dockerfile where you can start compiling contracts to Ethereum-friendly bytecode. By adding and subtracting pieces, and referring to future docs, I corrected the code which you currently see here.

                  Currently I cannot get “send” into compiling code, and that might be a good thing — I would like to see a more specific keyword for emptying the account. I’m not sure how to check the current balance without recording it in an instance variable (Solidity’s deprecated this.balance and newer address-casting-then-balance methods didn’t work). Also I didn’t get a chance to see how the percentage calculation works. [fix: track balance]
                </p>

                Libra spec and coding
                https://developers.libra.org/docs/assets/papers/libra-move-a-language-with-programmable-resources.pdf

                Gas pressure from optimization, vs. readability and security
                https://twitter.com/paddypisa/status/1149971603536666625

                In-browser basics
                https://github.com/austintgriffith/burner-wallet
                https://medium.com/metamask/eip-1102-preparing-your-dapp-5027b2c9ed76

                Android
                https://github.com/lumitechnologies/Lumi-SDK-Android

                Exchange launch kit
                https://blog.0xproject.com/introducing-the-0x-launch-kit-4acdc3453585

                https://medium.com/@kolten/explore-stellar-addresses-and-the-stellar-dex-using-python-e72611822b48
                https://twitter.com/sassal0x/status/1153665136726429696
                https://media.consensys.net/introducing-elle-a-formally-verified-evm-compiler-to-write-more-secure-ethereum-code-90d1038e1886

                https://github.com/oleiba/blockchain-getting-started/blob/master/README.md

              </section>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
